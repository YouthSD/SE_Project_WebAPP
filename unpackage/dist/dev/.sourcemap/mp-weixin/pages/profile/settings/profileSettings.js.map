{"version":3,"file":"profileSettings.js","sources":["pages/profile/settings/profileSettings.vue","D:/HTML5/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNccHJvZmlsZVxzZXR0aW5nc1xwcm9maWxlU2V0dGluZ3MudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    \n    <view class=\"header\" :style=\"{backgroundColor: primaryColor}\">\n      <back-icon iconSize=\"50\" @click=\"goBack\" class=\"back-icon\"></back-icon>\n      <text class=\"page-title\">设置个人资料</text>\n      <button class=\"save-btn\" :style=\"{backgroundColor: primaryColor}\" @click=\"handleSave\">保存</button>\n    </view>\n    \n    <view class=\"form-section\">\n      \n      <view class=\"form-item avatar-item\" @click=\"chooseAvatar\">\n        <text class=\"label\">头像</text>\n        <image :src=\"tempAvatar || currentProfile.avatar\" class=\"avatar-preview\" mode=\"aspectFill\"></image>\n      </view>\n      \n      <view class=\"form-item\">\n        <text class=\"label\">昵称</text>\n        <input class=\"input-field\" v-model=\"tempProfile.nickname\" placeholder=\"请输入昵称\" />\n        <text class=\"arrow\">✏️</text>\n      </view>\n      \n      <view class=\"form-item\">\n        <text class=\"label\">用户名</text>\n        <text class=\"input-field disabled-field\">@{{ currentProfile.username }}</text>\n      </view>\n      \n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      primaryColor: '#00CC99',\n      // 假设从接口获取的当前用户资料\n      currentProfile: {\n        avatar: '/static/major.jpg', \n        nickname: '空悲切',\n        username: 'dank1ng',\n      },\n      // 临时修改的数据\n      tempProfile: {\n        nickname: '小绿书用户',\n      },\n      tempAvatar: null, // 临时本地头像路径\n    };\n  },\n  onLoad() {\n    // 假设加载当前数据到 tempProfile\n    this.tempProfile.nickname = this.currentProfile.nickname;\n  },\n  methods: {\n    goBack() {\n      uni.navigateBack();\n    },\n    \n    // 选择头像并上传\n    chooseAvatar() {\n      uni.chooseImage({\n        count: 1,\n        sizeType: ['compressed'],\n        sourceType: ['album', 'camera'],\n        success: (res) => {\n          this.tempAvatar = res.tempFilePaths[0];\n          this.uploadAvatar(this.tempAvatar); // 自动开始上传\n        }\n      });\n    },\n    \n    uploadAvatar(filePath) {\n      // ** 模拟接口调用：头像上传 **\n      // 接口：/api/user/uploadAvatar\n      \n      uni.showLoading({ title: '头像上传中...' });\n      \n      /*\n      uni.uploadFile({\n        url: 'YOUR_AVATAR_UPLOAD_API', \n        filePath: filePath,\n        name: 'avatar',\n        success: (res) => {\n          uni.hideLoading();\n          const data = JSON.parse(res.data);\n          if (data.code === 0) {\n            // 成功替换：用新的 URL 更新 currentProfile.avatar\n            this.currentProfile.avatar = data.newAvatarUrl; \n            this.tempAvatar = null;\n            uni.showToast({ title: '头像上传并替换成功', icon: 'success' });\n          } else {\n            uni.showToast({ title: data.message || '上传失败', icon: 'none' });\n          }\n        },\n        fail: () => {\n          uni.hideLoading();\n          uni.showToast({ title: '网络错误，上传失败', icon: 'none' });\n        }\n      });\n      */\n      \n      // ** 临时成功模拟 **\n      setTimeout(() => {\n        uni.hideLoading();\n        // 假设上传成功，并获得了新的头像URL (这里继续使用本地路径模拟)\n        this.currentProfile.avatar = this.tempAvatar; \n        this.tempAvatar = null;\n        uni.showToast({ title: '头像上传并替换成功', icon: 'success' });\n      }, 1500);\n    },\n    \n    // 保存修改\n    handleSave() {\n      const newNickname = this.tempProfile.nickname.trim();\n      \n      if (newNickname.length === 0) {\n        uni.showToast({ title: '昵称不能为空', icon: 'none' });\n        return;\n      }\n      \n      if (newNickname === this.currentProfile.nickname) {\n        uni.showToast({ title: '资料未做修改', icon: 'none' });\n        return;\n      }\n      \n      // ** 模拟接口调用：保存资料 **\n      // 接口：/api/user/update\n      /*\n      uni.request({ \n        url: '/api/user/update', \n        method: 'POST', \n        data: { nickname: newNickname },\n        success: (res) => {\n          if (res.data.code === 0) {\n            this.currentProfile.nickname = newNickname;\n            uni.showToast({ title: '个人信息修改成功', icon: 'success' }); // 给予提示\n            this.goBack();\n            // 昵称同步更新到内容和评论中的逻辑由后端处理\n          } else {\n            uni.showToast({ title: res.data.message || '保存失败', icon: 'none' });\n          }\n        }\n      });\n      */\n      \n      // ** 临时成功模拟 **\n      this.currentProfile.nickname = newNickname;\n      uni.showToast({ title: '个人信息修改成功', icon: 'success' }); \n      this.goBack();\n    }\n  }\n}\n</script>\n\n<style scoped>\n.container {\n  height: 100vh;\n  background-color: #f7fff7;\n}\n\n/* --- 顶部导航栏 (与 settings 样式保持一致) --- */\n.header {\n  height: 90rpx;\n  display: flex;\n  align-items: center;\n  position: relative;\n  color: #ffffff;\n  font-weight: bold;\n  padding-top: var(--status-bar-height);\n  background-color: v-bind(primaryColor);\n}\n\n.back-icon {\n  position: absolute;\n  left: 30rpx;\n  font-size: 40rpx;\n  cursor: pointer;\n}\n\n.page-title {\n  flex: 1;\n  text-align: center;\n  font-size: 38rpx;\n  margin-left: 60rpx; /* 留出返回按钮的空间 */\n}\n\n.save-btn {\n  height: 60rpx;\n  line-height: 60rpx;\n  font-size: 30rpx;\n  color: #fff;\n  padding: 0 25rpx;\n  border-radius: 30rpx;\n  margin-right: 20rpx;\n}\n\n/* --- 表单区 --- */\n.form-section {\n  background-color: #ffffff;\n  margin-top: 20rpx;\n}\n\n.form-item {\n  display: flex;\n  align-items: center;\n  padding: 25rpx 30rpx;\n  border-bottom: 1rpx solid #f0f0f0;\n}\n\n.label {\n  width: 150rpx;\n  font-size: 32rpx;\n  color: #333;\n}\n\n.input-field {\n  flex: 1;\n  font-size: 32rpx;\n  text-align: right;\n  height: 50rpx;\n  line-height: 50rpx;\n}\n\n.disabled-field {\n  color: #999;\n}\n\n.arrow {\n  font-size: 30rpx;\n  color: #ccc;\n  margin-left: 15rpx;\n}\n\n.avatar-item {\n  height: 150rpx;\n}\n\n.avatar-preview {\n  width: 100rpx;\n  height: 100rpx;\n  border-radius: 50%;\n  margin-right: 15rpx;\n  border: 1rpx solid #eee;\n}\n</style>","import MiniProgramPage from 'C:/Users/HP/Desktop/软件工程/demo1/DemonTest/pages/profile/settings/profileSettings.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AAgCA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,cAAc;AAAA;AAAA,MAEd,gBAAgB;AAAA,QACd,QAAQ;AAAA,QACR,UAAU;AAAA,QACV,UAAU;AAAA,MACX;AAAA;AAAA,MAED,aAAa;AAAA,QACX,UAAU;AAAA,MACX;AAAA,MACD,YAAY;AAAA;AAAA;EAEf;AAAA,EACD,SAAS;AAEP,SAAK,YAAY,WAAW,KAAK,eAAe;AAAA,EACjD;AAAA,EACD,SAAS;AAAA,IACP,SAAS;AACPA,oBAAG,MAAC,aAAY;AAAA,IACjB;AAAA;AAAA,IAGD,eAAe;AACbA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,UAAU,CAAC,YAAY;AAAA,QACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QAC9B,SAAS,CAAC,QAAQ;AAChB,eAAK,aAAa,IAAI,cAAc,CAAC;AACrC,eAAK,aAAa,KAAK,UAAU;AAAA,QACnC;AAAA,MACF,CAAC;AAAA,IACF;AAAA,IAED,aAAa,UAAU;AAIrBA,oBAAAA,MAAI,YAAY,EAAE,OAAO,WAAY,CAAA;AA2BrC,iBAAW,MAAM;AACfA,sBAAG,MAAC,YAAW;AAEf,aAAK,eAAe,SAAS,KAAK;AAClC,aAAK,aAAa;AAClBA,sBAAG,MAAC,UAAU,EAAE,OAAO,aAAa,MAAM,UAAU,CAAC;AAAA,MACtD,GAAE,IAAI;AAAA,IACR;AAAA;AAAA,IAGD,aAAa;AACX,YAAM,cAAc,KAAK,YAAY,SAAS,KAAI;AAElD,UAAI,YAAY,WAAW,GAAG;AAC5BA,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,OAAK,CAAG;AAC/C;AAAA,MACF;AAEA,UAAI,gBAAgB,KAAK,eAAe,UAAU;AAChDA,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,OAAK,CAAG;AAC/C;AAAA,MACF;AAuBA,WAAK,eAAe,WAAW;AAC/BA,oBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,UAAU,CAAC;AACpD,WAAK,OAAM;AAAA,IACb;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtJA,GAAG,WAAW,eAAe;"}